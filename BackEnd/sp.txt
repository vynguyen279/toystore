CREATE PROC [dbo].[SP_THEM_GIO_HANG]
	@MASP nchar(10),
	@MAKH nchar(10),
	@SOLUONG int
AS
BEGIN
	IF EXISTS (SELECT MASP, MAKH FROM GIOHANG WHERE MASP = @MASP AND MAKH = @MAKH)
		UPDATE GIOHANG
		SET SOLUONG = SOLUONG + @SOLUONG
		WHERE @MASP = MASP AND @MAKH = MAKH
	ELSE INSERT INTO [dbo].[GIOHANG]
           ([MASP]
           ,[MAKH]
           ,[SOLUONG])
     VALUES
           (@MASP,@MAKH,@SOLUONG)
END

CREATE PROC SP_XOA_GIO_HANG
	@MASP nchar(10),
	@MAKH nchar(10),
	@SOLUONG int
AS
BEGIN
	IF EXISTS (SELECT MASP, MAKH FROM GIOHANG WHERE MASP = @MASP AND MAKH = @MAKH AND SOLUONG = @SOLUONG)
		DELETE FROM [dbo].[GIOHANG]
		WHERE MASP = @MASP AND MAKH = @MAKH
	ELSE UPDATE GIOHANG
		SET SOLUONG = SOLUONG - @SOLUONG
		WHERE @MASP = MASP AND @MAKH = MAKH
END

CREATE PROC [dbo].[SP_DON_DAT_HANG]
	@MAKH Nchar(10),
	@SDT Nchar(10),
	@EMAIL Nchar(100),
	@DIACHI Nvarchar(100),
	@TRANGTHAI Nchar(10)
AS 
BEGIN
	INSERT INTO DONDATHANG (DIACHI,SDT,TRANGTHAI,MAKH,EMAIL) VALUES (@DIACHI,@SDT,@TRANGTHAI,@MAKH,@EMAIL)
	SELECT TOP 1 MSDDH  FROM DONDATHANG WHERE MAKH = @MAKH ORDER BY MSDDH DESC
END